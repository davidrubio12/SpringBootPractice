<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardmarket Clone</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>

    <link rel="stylesheet" th:href="@{/styles/productDetails.css}">
</head>

<body>
<div th:replace="~{/fragments/header :: header}"></div>


<div class="content">
    <h1 th:text="${product.getName()}">Detalles de Producto</h1>
    <div class="section">

        <!-- Titulo dinámico con thymeleaf-->


        <div class="products">


            <p th:each="product : ${product}" th:href="@{/product/{id}(id=${product.id})}" class="product-card">

                <img th:if="${product.getImageUrl() != null}" th:src="@{${product.getImageUrl()}}"
                     alt="imagen del producto"/>

                <!-- Si category.getImageUrl() es null, mostramos la imagen por defecto -->
                <img th:if="${product.getImageUrl() == ''}" th:src="@{/static/imagenNoDisponible.png}"
                     alt="imagen del producto"/>


            <div th:if="${averageRating.isPresent()}" class="average-rating">
                <h3>Promedio de valoraciones</h3>
                <div class="stars">
                    <!-- Estrellas llenas -->
                    <span th:each="i : ${#numbers.sequence(1, T(java.lang.Math).floor(averageRating.get()))}">
                            <i class="full-star"></i>
                        </span>
                    <!-- Estrella media (si aplica) -->
                    <span th:if="${hasHalfStar}">
                            <i class="half-star"></i>
                        </span>
                </div>
                <p th:text="'Promedio: ' + ${averageRating.get()} + ' / 5'"></p>
            </div>
            <div th:if="${averageRating.isEmpty()}" class="average-rating">
                <p>No hay valoraciones</p>
            </div>


        </div>
        <div class="productsDetails">
            <h2>Precio del producto</h2>
            <p class="price" th:text="${product.price} + ' €'">Price</p>
            <h2>Descripción del producto </h2>
            <p th:text="${product.getDescription()}" class="description">Descripción del producto</p>

            <a th:href='@{/cart/add_cart/{productId}(productId=${product.id}, returnUrl=${currentUrl})}'
               id="addToCartButton" class="btn btn-primary">Añadir al carrito</a>


        </div>


    </div>


    <div class="rating">
        <h2>Valoraciones de los usuarios</h2>
        <p th:if="${averageRating.isEmpty()}">
            Este producto aún no tiene valoraciones.
        </p>
        <div th:if="${!ratings.isEmpty()}" th:each="rating : ${ratings}" class="rating">
            <div th:text="${rating.name}">John Doe</div>
            <div th:text="${rating.comentary}">Comentario del producto</div>
            <div>Fecha de publicación: <span th:text="${#dates.format(rating.date, 'yyyy-MM-dd')}"></span></div>
            <div class="stars">
                <!-- Bucle para mostrar estrellas completas -->
                <span th:each="i : ${#numbers.sequence(1, T(java.lang.Math).floor(rating.ratingNumber))}">
                <i class="full-star"></i>
            </span>
                <!-- Mostrar media estrella si existe -->
                <span th:if="${rating.ratingNumber % 1.0 >= 0.5}">
                <i class="half-star"></i>
                </span>

            </div>
        </div>

    </div>


</div>


<div th:replace="~{/fragments/footer :: footer}"></div>


</body>
<script>
    // Función para mostrar u ocultar el menú cuando se hace clic en el ícono de hamburguesa
    function toggleMenu() {
        const menu = document.getElementById('menu');
        const hamburger = document.getElementById('hamburger');
        menu.classList.toggle('show');
        hamburger.classList.toggle('open');
    }
</script>

</html>